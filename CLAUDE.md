# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

### Core Development Commands
- `npm run dev` - Starts both frontend (Vite) and backend (Convex) development servers in parallel
- `npm run dev:frontend` - Starts only the Vite frontend development server with auto-open
- `npm run dev:backend` - Starts only the Convex backend development server
- `npm run predev` - Sets up Convex development environment, runs setup script, and opens dashboard

### Build and Quality Commands
- `npm run build` - TypeScript compilation followed by Vite build
- `npm run lint` - TypeScript check and ESLint with strict settings (max 0 warnings)
- `npm run preview` - Preview the built application

### Setup Commands
- `npx @convex-dev/auth` - Configure Convex Auth environment variables
- `npx convex env set RESEND_API_KEY "<your-api-key>"` - Set Resend API key
- `npx convex env set RESEND_WEBHOOK_SECRET "<your-webhook-secret>"` - Set webhook secret
- `npx convex env get CONVEX_SITE_URL` - Get site URL for webhook configuration

## Project Architecture

This is a **Convex + Resend email testing demo** built with React, TypeScript, and Tailwind CSS.

### Stack Overview
- **Backend**: Convex (database + server logic)
- **Email Service**: Resend with the official Convex Resend Component
- **Authentication**: Convex Auth with password provider
- **Frontend**: React 19 + Vite + TypeScript
- **Styling**: Tailwind CSS v4 with dark mode support

### Key Architecture Patterns

#### Email System Architecture
- **Queueing & Batching**: Resend Component handles email queuing and batching automatically
- **Durable Execution**: Uses Convex workpools for guaranteed email delivery
- **Idempotency**: Automatic idempotency key management prevents duplicate emails
- **Rate Limiting**: Built-in Resend API rate limit handling
- **Event Tracking**: Webhook integration for delivery status tracking

#### Authentication Flow
- Password-based authentication using Convex Auth
- User profiles stored with email and name
- Protected routes using `<Authenticated>` and `<Unauthenticated>` components
- Email domain verification required for sending (must match verified Resend domain)

#### Database Schema (`convex/schema.ts`)
- `emails` table: Links users to sent emails via `emailId` from Resend Component
- Auth tables: Generated by `@convex-dev/auth/server`
- Index on `userId` for efficient email history queries

#### Frontend Architecture
- **Routing**: React Router v6 with protected routes and layouts
- **Component Structure**: Page-based architecture with shared layout components
- **State Management**: Convex real-time queries with `useQuery` for data fetching
- **UI Components**: shadcn/ui component library with consistent theming
- **Services Layer**: Utility functions for email formatting, validation, and templates
- **Test Email Addresses**: `delivered@resend.dev`, `bounced@resend.dev`, `complained@resend.dev`

### File Structure
```
convex/
├── auth.ts - Convex Auth configuration with password provider
├── emails.ts - Email sending, history, and event handling
├── http.ts - HTTP endpoints (auto-generated)
├── schema.ts - Database schema with auth tables
└── convex.config.ts - Convex configuration

src/
├── components/
│   ├── ui/ - shadcn/ui component library
│   ├── auth/ - Authentication components
│   ├── layout/ - Dashboard layout and navigation
│   └── pages/ - Page components for each route
├── services/ - Utility services for email operations
├── hooks/ - Custom React hooks
└── App.tsx - Main React application with routing
```

### Convex Guidelines Integration
This project follows the comprehensive Convex guidelines defined in `.cursor/rules/convex_rules.mdc`:
- Uses new function syntax with explicit args/returns validators
- Proper function registration (public vs internal functions)
- Index-based queries instead of filters
- TypeScript strict typing with `Id<"tableName">` types

### Resend Component Integration
- Initialized in `convex/emails.ts` with test mode enabled
- Email event handling via `onEmailEvent` webhook
- Email status tracking (delivered, bounced, opened, complained)
- Automatic email data management and cleanup

### Development Notes
- The `setup.mjs` script runs `npx @convex-dev/auth` automatically during `predev`
- Vite config includes Tailwind CSS plugin and path alias (`@` -> `./src`)
- ESLint configured with React hooks and refresh plugins
- TypeScript strict mode enabled with modern module resolution

### Design System Guidelines
- **NEVER modify `src/index.css`** - This file contains the project's design tokens and should remain untouched
- Use only shadcn/ui components from `src/components/ui/` for all UI elements
- No custom styling should be added outside of shadcn/ui components

### Routing Structure
The application uses React Router v6 for URL-based navigation:

#### Available Routes
- `/` - Redirects to `/dashboard`
- `/dashboard` - Main dashboard with email stats and quick send
- `/send-email` - Full email composer with advanced features
- `/email-history` - Searchable list of sent emails with status tracking
- `/analytics` - Comprehensive email performance metrics
- `/resources` - Documentation and helpful links
- `/settings` - Account management and configuration
- `/help` - User support and troubleshooting guides

#### Route Protection
- All routes are protected by authentication
- Unauthenticated users are redirected to sign-in form
- Uses `ProtectedRoute` component wrapper for authentication checks